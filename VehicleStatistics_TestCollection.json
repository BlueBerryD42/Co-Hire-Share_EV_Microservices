{
  "info": {
    "name": "Vehicle Statistics API Tests",
    "description": "Complete test collection for Vehicle Statistics endpoint",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. Auth - Login to get token",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has accessToken\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('accessToken');",
              "    pm.expect(jsonData.accessToken).to.be.a('string');",
              "    pm.expect(jsonData.accessToken.length).to.be.greaterThan(0);",
              "});",
              "",
              "if (pm.response.code === 200) {",
              "    var jsonData = pm.response.json();",
              "    pm.collectionVariables.set(\"jwt_token\", jsonData.accessToken);",
              "    console.log(\"Token saved: \" + jsonData.accessToken.substring(0, 50) + \"...\");",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"admin@coev.com\",\n  \"password\": \"Admin123!\"\n}"
        },
        "url": {
          "raw": "{{auth_base_url}}/api/auth/login",
          "host": ["{{auth_base_url}}"],
          "path": ["api", "auth", "login"]
        }
      },
      "response": []
    },
    {
      "name": "2. Get Vehicle Statistics - Default (30 days)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Response has required fields\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('vehicleId');",
              "    pm.expect(jsonData).to.have.property('vehicleName');",
              "    pm.expect(jsonData).to.have.property('usage');",
              "    pm.expect(jsonData).to.have.property('utilization');",
              "    pm.expect(jsonData).to.have.property('efficiency');",
              "    pm.expect(jsonData).to.have.property('patterns');",
              "    pm.expect(jsonData).to.have.property('trendsOverTime');",
              "});",
              "",
              "pm.test(\"Total days should be around 30\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.totalDays).to.be.at.least(28);",
              "    pm.expect(jsonData.totalDays).to.be.at.most(31);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"]
        },
        "description": "Get statistics for last 30 days with default parameters"
      },
      "response": []
    },
    {
      "name": "3. Get Statistics - Custom Date Range",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Date range is Q1 2025 (90 days)\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.totalDays).to.equal(90);",
              "    pm.expect(jsonData.startDate).to.include('2025-01-01');",
              "    pm.expect(jsonData.endDate).to.include('2025-03-31');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics?startDate=2025-01-01&endDate=2025-03-31",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"],
          "query": [
            {
              "key": "startDate",
              "value": "2025-01-01",
              "description": "Start date for statistics period"
            },
            {
              "key": "endDate",
              "value": "2025-03-31",
              "description": "End date for statistics period"
            }
          ]
        },
        "description": "Get statistics for Q1 2025 (January to March)"
      },
      "response": []
    },
    {
      "name": "4. Get Statistics - Daily Grouping",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Trends are grouped daily\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.trendsOverTime).to.be.an('array');",
              "    if (jsonData.trendsOverTime.length > 0) {",
              "        pm.expect(jsonData.trendsOverTime[0].period).to.match(/^\\d{4}-\\d{2}-\\d{2}$/);",
              "    }",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics?groupBy=daily",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"],
          "query": [
            {
              "key": "groupBy",
              "value": "daily",
              "description": "Group trends by day"
            }
          ]
        },
        "description": "Get statistics with daily trend grouping"
      },
      "response": []
    },
    {
      "name": "5. Get Statistics - Weekly Grouping",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Trends are grouped weekly\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.trendsOverTime).to.be.an('array');",
              "    if (jsonData.trendsOverTime.length > 0) {",
              "        pm.expect(jsonData.trendsOverTime[0].period).to.match(/^W\\d+/);",
              "    }",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics?groupBy=weekly&startDate=2025-01-01&endDate=2025-03-31",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"],
          "query": [
            {
              "key": "groupBy",
              "value": "weekly",
              "description": "Group trends by week"
            },
            {
              "key": "startDate",
              "value": "2025-01-01"
            },
            {
              "key": "endDate",
              "value": "2025-03-31"
            }
          ]
        },
        "description": "Get Q1 statistics with weekly trend grouping"
      },
      "response": []
    },
    {
      "name": "6. Get Statistics - Monthly Grouping",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Trends are grouped monthly\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.trendsOverTime).to.be.an('array');",
              "    pm.expect(jsonData.totalDays).to.equal(366);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics?groupBy=monthly&startDate=2024-01-01&endDate=2024-12-31",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"],
          "query": [
            {
              "key": "groupBy",
              "value": "monthly",
              "description": "Group trends by month"
            },
            {
              "key": "startDate",
              "value": "2024-01-01"
            },
            {
              "key": "endDate",
              "value": "2024-12-31"
            }
          ]
        },
        "description": "Get full year 2024 statistics with monthly trend grouping"
      },
      "response": []
    },
    {
      "name": "7. Get Statistics - Without Benchmarks",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Benchmarks should be null\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.benchmarks).to.be.null;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics?includeBenchmarks=false",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"],
          "query": [
            {
              "key": "includeBenchmarks",
              "value": "false",
              "description": "Exclude benchmark comparisons"
            }
          ]
        },
        "description": "Get statistics without benchmark comparisons (faster response)"
      },
      "response": []
    },
    {
      "name": "8. Get Statistics - With Benchmarks",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Benchmarks should be included\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.benchmarks).to.not.be.null;",
              "    pm.expect(jsonData.benchmarks).to.have.property('groupAverage');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics?includeBenchmarks=true",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"],
          "query": [
            {
              "key": "includeBenchmarks",
              "value": "true",
              "description": "Include benchmark comparisons"
            }
          ]
        },
        "description": "Get statistics with group average and similar vehicles comparison"
      },
      "response": []
    },
    {
      "name": "9. Get Statistics - Full Year 2024",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Full year 2024 data\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.totalDays).to.equal(366);",
              "    pm.expect(jsonData.benchmarks).to.not.be.null;",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics?startDate=2024-01-01&endDate=2024-12-31&groupBy=monthly&includeBenchmarks=true",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"],
          "query": [
            {
              "key": "startDate",
              "value": "2024-01-01"
            },
            {
              "key": "endDate",
              "value": "2024-12-31"
            },
            {
              "key": "groupBy",
              "value": "monthly"
            },
            {
              "key": "includeBenchmarks",
              "value": "true"
            }
          ]
        },
        "description": "Complete statistics for full year 2024 with monthly grouping and benchmarks"
      },
      "response": []
    },
    {
      "name": "10. Get Statistics - Last 7 Days",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200\", function () {",
              "    pm.response.to.have.status(200);",
              "});",
              "",
              "pm.test(\"Last 7 days data\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData.totalDays).to.be.at.least(7);",
              "    pm.expect(jsonData.totalDays).to.be.at.most(8);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics?startDate={{seven_days_ago}}&endDate={{today}}&groupBy=daily",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"],
          "query": [
            {
              "key": "startDate",
              "value": "{{seven_days_ago}}"
            },
            {
              "key": "endDate",
              "value": "{{today}}"
            },
            {
              "key": "groupBy",
              "value": "daily"
            }
          ]
        },
        "description": "Get statistics for last 7 days with daily breakdown"
      },
      "response": []
    },
    {
      "name": "11. ERROR - Vehicle Not Found (404)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 404\", function () {",
              "    pm.response.to.have.status(404);",
              "});",
              "",
              "pm.test(\"Error message present\", function () {",
              "    var jsonData = pm.response.json();",
              "    pm.expect(jsonData).to.have.property('message');",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/00000000-0000-0000-0000-000000000000/statistics",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "00000000-0000-0000-0000-000000000000", "statistics"]
        },
        "description": "Test with non-existent vehicle ID - should return 404"
      },
      "response": []
    },
    {
      "name": "12. ERROR - Unauthorized (401)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 401\", function () {",
              "    pm.response.to.have.status(401);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"]
        },
        "description": "Test without authorization token - should return 401"
      },
      "response": []
    },
    {
      "name": "13. ERROR - Invalid Token (401)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 401\", function () {",
              "    pm.response.to.have.status(401);",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer invalid_token_here",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"]
        },
        "description": "Test with invalid token - should return 401"
      },
      "response": []
    },
    {
      "name": "14. ERROR - User Not in Vehicle Group (403)",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 403 (or skip if no other_user_token)\", function () {",
              "    if (pm.collectionVariables.get('other_user_token') && pm.collectionVariables.get('other_user_token') !== '') {",
              "        pm.response.to.have.status(403);",
              "    } else {",
              "        console.log('Skipped: No other_user_token set');",
              "    }",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{other_user_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"]
        },
        "description": "Test with user who's not in vehicle's group - should return 403"
      },
      "response": []
    },
    {
      "name": "15. Get Statistics - Invalid GroupBy",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test(\"Status code is 200 or 400\", function () {",
              "    pm.expect(pm.response.code).to.be.oneOf([200, 400]);",
              "});",
              "",
              "pm.test(\"If 200, should have valid response structure\", function () {",
              "    if (pm.response.code === 200) {",
              "        var jsonData = pm.response.json();",
              "        pm.expect(jsonData).to.have.property('vehicleId');",
              "    }",
              "});"
            ]
          }
        }
      ],
      "request": {
        "method": "GET",
        "header": [
          {
            "key": "Authorization",
            "value": "Bearer {{jwt_token}}",
            "type": "text"
          }
        ],
        "url": {
          "raw": "{{base_url}}/api/vehicle/{{vehicle_id}}/statistics?groupBy=invalid",
          "host": ["{{base_url}}"],
          "path": ["api", "vehicle", "{{vehicle_id}}", "statistics"],
          "query": [
            {
              "key": "groupBy",
              "value": "invalid",
              "description": "Invalid groupBy value"
            }
          ]
        },
        "description": "Test with invalid groupBy parameter - should return 400 or default to daily"
      },
      "response": []
    }
  ],
  "variable": [
    {
      "key": "base_url",
      "value": "https://localhost:61603",
      "type": "string"
    },
    {
      "key": "auth_base_url",
      "value": "https://localhost:61601",
      "type": "string"
    },
    {
      "key": "vehicle_id",
      "value": "2296D6F7-F501-42D5-ABA9-56A3EBD835EC",
      "type": "string"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "other_user_token",
      "value": "",
      "type": "string"
    },
    {
      "key": "today",
      "value": "2025-11-01",
      "type": "string"
    },
    {
      "key": "seven_days_ago",
      "value": "2025-10-25",
      "type": "string"
    }
  ]
}
